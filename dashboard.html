<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Business Dashboard | AlohaChatAI</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    />
    <style>
      :root {
        --primary: #4f46e5;
        --primary-light: #6366f1;
        --primary-dark: #4338ca;
        --secondary: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: #f9fafb;
        color: var(--gray-800);
        line-height: 1.5;
      }

      .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      header {
        background-color: white;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 50;
      }

      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary);
      }

      .nav-links {
        display: flex;
        gap: 1.5rem;
      }

      .nav-links a {
        text-decoration: none;
        color: var(--gray-600);
        font-weight: 500;
        transition: color 0.2s;
      }

      .nav-links a:hover {
        color: var(--primary);
      }

      .dashboard {
        padding: 2rem 0;
      }

      .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .dashboard-title h1 {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--gray-900);
      }

      .dashboard-title p {
        color: var(--gray-500);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background-color: white;
        border-radius: 0.5rem;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .stat-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
      }

      .stat-card-title {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--gray-500);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .stat-card-icon {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--primary-light);
        color: white;
      }

      .stat-card-value {
        font-size: 1.875rem;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 0.25rem;
      }

      .stat-card-desc {
        font-size: 0.875rem;
        color: var(--gray-500);
      }

      .usage-card {
        background-color: white;
        border-radius: 0.5rem;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
      }

      .usage-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .usage-card-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--gray-800);
      }

      .usage-bar {
        height: 8px;
        background-color: var(--gray-200);
        border-radius: 4px;
        margin-bottom: 1rem;
        overflow: hidden;
      }

      .usage-bar-fill {
        height: 100%;
        background-color: var(--primary);
        border-radius: 4px;
        transition: width 0.5s ease;
      }

      .usage-details {
        display: flex;
        justify-content: space-between;
      }

      .usage-detail {
        display: flex;
        flex-direction: column;
      }

      .usage-detail-label {
        font-size: 0.875rem;
        color: var(--gray-500);
        margin-bottom: 0.25rem;
      }

      .usage-detail-value {
        font-weight: 600;
        color: var(--gray-800);
      }

      .recent-activity {
        background-color: white;
        border-radius: 0.5rem;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .recent-activity-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .recent-activity-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--gray-800);
      }

      .activity-list {
        list-style: none;
      }

      .activity-item {
        display: flex;
        padding: 1rem 0;
        border-bottom: 1px solid var(--gray-200);
      }

      .activity-item:last-child {
        border-bottom: none;
      }

      .activity-icon {
        margin-right: 1rem;
        color: var(--primary);
      }

      .activity-content {
        flex: 1;
      }

      .activity-message {
        margin-bottom: 0.25rem;
        color: var(--gray-800);
      }

      .activity-time {
        font-size: 0.875rem;
        color: var(--gray-500);
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        font-weight: 500;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
      }

      .btn-primary {
        background-color: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background-color: var(--primary-dark);
      }

      .btn-secondary {
        background-color: var(--gray-100);
        color: var(--gray-700);
      }

      .btn-secondary:hover {
        background-color: var(--gray-200);
      }

      .btn-danger {
        background-color: var(--danger);
        color: white;
      }

      .btn-danger:hover {
        background-color: #dc2626;
      }

      .btn-group {
        display: flex;
        gap: 0.75rem;
      }

      .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .quick-action-card {
        background-color: white;
        border-radius: 0.5rem;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .quick-action-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .quick-action-card h3 {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--gray-800);
      }

      .quick-action-card p {
        font-size: 0.875rem;
        color: var(--gray-500);
        margin-bottom: 1.5rem;
      }

      .alert {
        padding: 1rem;
        border-radius: 0.375rem;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
      }

      .alert-warning {
        background-color: #fffbeb;
        color: #92400e;
        border-left: 4px solid var(--warning);
      }

      .alert-icon {
        margin-right: 0.75rem;
        font-size: 1.25rem;
      }

      .alert-content h4 {
        font-weight: 600;
        margin-bottom: 0.25rem;
      }

      .alert-content p {
        font-size: 0.875rem;
      }

      @media (max-width: 768px) {
        .stats-grid {
          grid-template-columns: 1fr;
        }

        .dashboard-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 1rem;
        }

        .btn-group {
          width: 100%;
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <header>
      <div class="container">
        <nav>
          <div class="logo">AlohaChatAI</div>
          <div class="nav-links">
            <a href="dashboard.html">Dashboard</a>
            <a href="upgrade.html">Upgrade</a>
            <a href="#" id="logout-btn">Logout</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container dashboard">
      <div class="dashboard-header">
        <div class="dashboard-title">
          <h1>Welcome back, <span id="business-name">Loading...</span></h1>
          <p>Here's what's happening with your account today</p>
        </div>
        <div class="btn-group">
          <button id="upgrade-btn" class="btn btn-primary">Upgrade Plan</button>
          <button id="buy-msgs-btn" class="btn btn-secondary">
            Buy Messages
          </button>
        </div>
      </div>

      <div
        class="alert alert-warning"
        id="low-message-alert"
        style="display: none"
      >
        <div class="alert-icon">⚠️</div>
        <div class="alert-content">
          <h4>Low message balance</h4>
          <p>
            You're running low on messages. Consider upgrading your plan or
            purchasing additional messages.
          </p>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-card-header">
            <span class="stat-card-title">Messages Used</span>
            <div class="stat-card-icon">💬</div>
          </div>
          <div class="stat-card-value" id="messages-used">0</div>
          <p class="stat-card-desc">Total messages sent this month</p>
        </div>

        <div class="stat-card">
          <div class="stat-card-header">
            <span class="stat-card-title">Messages Remaining</span>
            <div class="stat-card-icon">🔢</div>
          </div>
          <div class="stat-card-value" id="message-count">0</div>
          <p class="stat-card-desc">Available in your current plan</p>
        </div>

        <div class="stat-card">
          <div class="stat-card-header">
            <span class="stat-card-title">Current Plan</span>
            <div class="stat-card-icon">📊</div>
          </div>
          <div class="stat-card-value" id="current-plan">None</div>
          <p class="stat-card-desc" id="plan-details">No active subscription</p>
        </div>
      </div>

      <div class="usage-card">
        <div class="usage-card-header">
          <h2 class="usage-card-title">Message Usage</h2>
          <span class="stat-card-desc"
            >Monthly cycle resets on <span id="billing-cycle">1st</span></span
          >
        </div>
        <div class="usage-bar">
          <div class="usage-bar-fill" id="usage-bar" style="width: 0%"></div>
        </div>
        <div class="usage-details">
          <div class="usage-detail">
            <span class="usage-detail-label">Used</span>
            <span class="usage-detail-value" id="used-value">0</span>
          </div>
          <div class="usage-detail">
            <span class="usage-detail-label">Remaining</span>
            <span class="usage-detail-value" id="remaining-value">0</span>
          </div>
          <div class="usage-detail">
            <span class="usage-detail-label">Total</span>
            <span class="usage-detail-value" id="total-value">0</span>
          </div>
        </div>
      </div>

      <div class="card-grid">
        <div class="quick-action-card">
          <h3>Get More Messages</h3>
          <p>
            Purchase additional message packs to keep your business running
            smoothly.
          </p>
          <button class="btn btn-primary" id="buy-msgs-btn-2">
            Buy Messages
          </button>
        </div>
        <div class="quick-action-card">
          <h3>Upgrade Your Plan</h3>
          <p>
            Unlock higher message limits and additional features with our
            premium plans.
          </p>
          <button class="btn btn-primary" id="upgrade-btn-2">View Plans</button>
        </div>
        <div class="quick-action-card">
          <h3>Account Settings</h3>
          <p>
            Update your business information, billing details, and preferences.
          </p>
          <button class="btn btn-secondary" id="settings-btn">Settings</button>
        </div>
      </div>

      <div class="recent-activity">
        <div class="recent-activity-header">
          <h2 class="recent-activity-title">Recent Activity</h2>
          <button class="btn btn-secondary">View All</button>
        </div>
        <ul class="activity-list" id="activity-list">
          <li class="activity-item">
            <div class="activity-icon">📊</div>
            <div class="activity-content">
              <p class="activity-message">Your monthly usage report is ready</p>
              <span class="activity-time">Just now</span>
            </div>
          </li>
          <li class="activity-item">
            <div class="activity-icon">💬</div>
            <div class="activity-content">
              <p class="activity-message">Sent 15 messages to customers</p>
              <span class="activity-time">2 hours ago</span>
            </div>
          </li>
          <li class="activity-item">
            <div class="activity-icon">🔄</div>
            <div class="activity-content">
              <p class="activity-message">Plan updated to Business Tier</p>
              <span class="activity-time">Yesterday</span>
            </div>
          </li>
        </ul>
      </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

    <script>
      function goTo(page) {
        window.location.href = `${location.origin}${location.pathname.replace(
          /[^/]*$/,
          ""
        )}${page}`;
      }

      const firebaseConfig = {
        apiKey: "AIzaSyDj8RVucd-TZBVQt080g_nk1MKU6knGZ8o",
        authDomain: "chatbot-8cc09.firebaseapp.com",
        projectId: "chatbot-8cc09",
        storageBucket: "chatbot-8cc09.firebasestorage.app",
        messagingSenderId: "362283614085",
        appId: "1:362283614085:web:146160adf6b5d2b198ceec",
        measurementId: "G-MWYVYVSGHE",
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();

      // Sample plan details (you would replace this with your actual plan data)
      const planDetails = {
        free: {
          name: "Free Tier",
          limit: 100,
          desc: "Basic access with limited messages",
        },
        starter: {
          name: "Starter",
          limit: 500,
          desc: "For small businesses getting started",
        },
        business: {
          name: "Business",
          limit: 2000,
          desc: "For growing businesses with moderate needs",
        },
        enterprise: {
          name: "Enterprise",
          limit: 10000,
          desc: "For high-volume business needs",
        },
        none: {
          name: "None",
          limit: 0,
          desc: "No active subscription",
        },
      };

      auth.onAuthStateChanged(async (user) => {
        if (!user) {
          goTo("signup-login.html");
          return;
        }

        const uid = user.uid;
        try {
          const doc = await db.collection("businesses").doc(uid).get();
          const data = doc.data();

          // Update basic info
          document.getElementById("business-name").textContent =
            data.name || "Business";

          // Update plan info
          const plan = data.plan || "none";
          const planData = planDetails[plan] || planDetails["none"];
          document.getElementById("current-plan").textContent = planData.name;
          document.getElementById("plan-details").textContent = planData.desc;

          // Update message counts
          const messagesLeft = data.messagesLeft ?? 0;
          const messagesUsed =
            planData.limit - messagesLeft > 0
              ? planData.limit - messagesLeft
              : 0;

          document.getElementById("message-count").textContent = messagesLeft;
          document.getElementById("messages-used").textContent = messagesUsed;

          // Update usage bar and values
          if (planData.limit > 0) {
            const usagePercent = (messagesUsed / planData.limit) * 100;
            document.getElementById(
              "usage-bar"
            ).style.width = `${usagePercent}%`;
            document.getElementById("used-value").textContent = messagesUsed;
            document.getElementById("remaining-value").textContent =
              messagesLeft;
            document.getElementById("total-value").textContent = planData.limit;
          } else {
            document.getElementById("usage-bar").style.width = "0%";
            document.getElementById("used-value").textContent = "0";
            document.getElementById("remaining-value").textContent = "0";
            document.getElementById("total-value").textContent = "0";
          }

          // Show low message alert if less than 20% remaining
          if (messagesLeft / planData.limit < 0.2 && planData.limit > 0) {
            document.getElementById("low-message-alert").style.display = "flex";
          }

          // Set billing cycle date (sample - you would use your actual billing cycle logic)
          const today = new Date();
          const nextMonth = new Date(
            today.getFullYear(),
            today.getMonth() + 1,
            1
          );
          document.getElementById("billing-cycle").textContent =
            nextMonth.getDate() +
            getOrdinalSuffix(nextMonth.getDate()) +
            " " +
            nextMonth.toLocaleString("default", { month: "long" });
        } catch (err) {
          console.error("Error loading dashboard:", err);
        }
      });

      // Helper function for date ordinal suffixes
      function getOrdinalSuffix(day) {
        if (day > 3 && day < 21) return "th";
        switch (day % 10) {
          case 1:
            return "st";
          case 2:
            return "nd";
          case 3:
            return "rd";
          default:
            return "th";
        }
      }

      // Event listeners
      document.getElementById("logout-btn").addEventListener("click", () => {
        auth.signOut().then(() => goTo("signup-login.html"));
      });

      document.getElementById("upgrade-btn").addEventListener("click", () => {
        goTo("upgrade.html");
      });

      document.getElementById("upgrade-btn-2").addEventListener("click", () => {
        goTo("upgrade.html");
      });

      document.getElementById("buy-msgs-btn").addEventListener("click", () => {
        goTo("buy-messages.html");
      });

      document
        .getElementById("buy-msgs-btn-2")
        .addEventListener("click", () => {
          goTo("buy-messages.html");
        });

      document.getElementById("settings-btn").addEventListener("click", () => {
        goTo("settings.html");
      });
    </script>
  </body>
</html>
